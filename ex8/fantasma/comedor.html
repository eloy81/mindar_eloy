<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://castelletm12b.cat/build/assets/question.js" defer></script>  
    <script>
      AFRAME.registerComponent("mylink", {
        schema: { href: { type: "string" } },
        init: function () {
          this.el.addEventListener("click", () => {
            window.location = this.data.href;
          });
        }
      });
    </script>
  </head>

  <body>
    <a-scene cursor="rayOrigin: mouse">
      <a-assets>
        <img id="imgSortida" src="assets/entragroc.png">
        <img id="imgFantasma" src="assets/fantasma.png">
        <img id="imgCasa" src="assets/comedor1.jpeg">
        <audio id="audio" src="assets/aplausos.mp3"></audio>
      </a-assets>

      <!-- Cámara + cursor -->
      <a-entity rotation="0 95 0">
        <a-entity camera look-controls wasd-controls="true">
          <a-entity cursor="fuse: true; fuseTimeout: 2000"
                    position="0 0 -1"
                    material="color: red; shader: flat"
                    animation="property: components.material.material.color;
                              type: color; to: white; dur: 1000;
                              dir: alternate; loop: true">
          </a-entity>
        </a-entity>
      </a-entity>

      <!-- Texto frente a la cámara -->
      <a-text value="Felicitats, has aconseguit sortir del bucle"
              rotation="0 90 0"
              position="-5 0.5 0"
              color="#000000"
              align="center"
              width="10">
      </a-text>

      <!-- Fondo -->
      <a-sky src="#imgCasa"></a-sky>

      <!-- Fantasma animado -->
      <a-sphere question="88" position="5 2 -5" radius="1" src="#imgFantasma"
                animation="property: rotation; dur: 2000;
                           to: 0 360 0; loop: true">
      </a-sphere>
      <a-entity id="sound" sound="src: #audio"></a-entity>
      
      <!-- Botón de salida -->
      <a-plane position="1 1 5"
               src="#imgSortida"
               rotation="0 -180 0"
               transparent="true"
               mylink="href: /eleccion.html">
      </a-plane>
    </a-scene>
  </body>
</html>
